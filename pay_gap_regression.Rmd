---
title: "A Regression Analysis of the Gender Pay Gap"
author: "Maria-Cristiana Gîrjău"
date: "Revised on 2019-09-20"
output: 
  pdf_document:
    fig_height: 2
    fig_width: 3.5
    df_print: kable
---

```{r, setup, include=FALSE}
# Loading necessary packages
require(readr)
require(dplyr)
require(ggplot2)
require(forcats)
require(stringr)
require(purrr)
require(kableExtra)

# Setting default chunk and display options
knitr::opts_chunk$set(
  # display code as typed
  tidy = F,
  # slightly smaller font for code
  size = "small",
  # tab plain R output
  comment = "\t",
  # center figures
  fig.align = "center",
  # suppress warnings & messages in knitted doc
  warning = F, message = F)   

# greyscale ggplot theme
theme_set(theme_classic())

# not using scientific notation
options(scipen = 1)
```

<!-- This document should include all the code used to wrangle and analze your data. You should comment your code within each code chunk, and you should document your process as you go. This means describing what each code chunk is doing if it's not immediately obvious (e.g., "After reading in the data, we noticed that this categorical variable was being treated as a numeric variable, so we forced it to be a factor instead."), every decision you made (e.g., "In the code below, we dropped every person over 90 years old and collapsed such-and-such categorical variable down to three categories instead of 10."), and what you are gathering from any output (e.g., "The histogram above shows us that the data are skewed right with one extreme outlier around 300."). Only set `echo=F` for code you do not want to receive feedback on. Use `eval=F` if there is code that is not working and that you want help with! -->

# Data wrangling

<!-- Get the data into the format needed for analysis. Any time in other sections that you realize your data should actually look a different way (e.g, maybe you decide you really want to collapse a categorical variable or something), make sure to come back to this section to implement that change from the beginning. This will be an iterative process! -->

```{r, import}
# Reading in the dataset
acs_sample_raw <- read_csv("data/acs230_3k.csv")
```

```{r, factors}
# setting factor levels

sex_levels <- c(male = "1",
                female = "2")

citizenship_levels <- c(US_born = "1",
                        territories_born = "2",
                        aborad_born = "3",
                        naturalized = "4",
                        not_citizen = "5")

race_levels <- c(white = "1",
                  black = "2",
                  native = "3",
                  native = "4",
                  native = "5",
                  asian = "6",
                  pacific_islander = "7",
                  other = "8",
                  multiple = "9")


military_levels <- c(active = "1",
                     past = "2",
                     training = "3",
                     never = "4")

disabled_levels <- c(yes = "1",
                       no = "2")

married_levels <- c(married = "1",
                    widowed = "2",
                    divorced = "3",
                    separated = "4",
                    never = "5")

children_age_levels <- c(under_six = "1",
                         above_six = "2",
                         both = "3",
                         none = "4")

gave_birth_levels <- c(yes = "1",
                       no = "2")

education_levels <- c(none = "1",
                      preschool = "2",
                      kindergarten = "3",
                      grade_1 = "4",
                      grade_2 = "5",
                      grade_3 = "6",
                      grade_4 = "7",
                      grade_5 = "8",
                      grade_6 = "9",
                      grade_7 = "10",
                      grade_8 = "11",
                      grade_9 = "12",
                      grade_10 = "13",
                      grade_11 = "14",
                      grade_12 = "15",
                      high_school = "16",
                      GED = "17",
                      college_one_year_less = "18",
                      college_one_year_more = "19",
                      associate = "20",
                      bachelor = "21",
                      master = "22",
                      professional = "23",
                      doctoral = "24")

degree_levels <- c()

stem_degree_levels <- c(yes = "1",
                        no = "2")

employment_levels <- c(employed_working = "1",
                       employed_not_working = "2",
                       unemployed = "3",
                       military_working = "4",
                       military_not_working = "5",
                       not_in_labor_force = "6")

worker_class_levels <- c()

region_levels <- c(northeast = "1",
                   midwest = "2",
                   south = "3",
                   west = "4",
                   puerto_rico = "9")

state_levels <- c(Alabama = "1",
                  Alaska = "2",
                  Arizona = "4",
                  Arkansas = "5",
                  California = "6",
                  Colorado = "8",
                  Connecticut = "9",
                  Delaware = "10",
                  District_of_Columbia = "11",
                  Florida = "12",
                  Georgia = "13",
                  Hawaii = "15",
                  Idaho = "16",
                  Illinois = "17",
                  Indiana = "18",
                  Iowa = "19",
                  Kansas = "20",
                  Kentucky = "21",
                  Louisiana = "22",
                  Maine = "23",
                  Maryland = "24",
                  Massachusetts = "25",
                  Michigan = "26",
                  Minnesota = "27",
                  Mississippi = "28",
                  Missouri = "29",
                  Montana = "30",
                  Nebraska = "31",
                  Nevada = "32",
                  New_Hampshire = "33",
                  New_Jersey = "34",
                  New_Mexico = "35",
                  New_York = "36",
                  North_Carolina = "37",
                  North_Dakota = "38",
                  Ohio = "39",
                  Oklahoma = "40",
                  Oregon = "41",
                  Pennsylvania = "42",
                  Rhode_Island = "44",
                  South_Carolina = "45",
                  South_Dakota = "46",
                  Tennessee = "47",
                  Texas = "48",
                  Utah = "49",
                  Vermont = "50",
                  Virginia = "51",
                  Washington = "53",
                  West_Virginia = "54",
                  Wisconsin = "55",
                  Wyoming = "56",
                  Puerto_Rico = "72")

```

```{r, variables}
# Wrangling the data
acs_sample <- acs_sample_raw %>%
  
  mutate(ADJINC.x = ADJINC.x / 10^6, # adding decimal point to ADJINC
         HINCP = HINCP * ADJINC.x, # adjusting dollar amounts for inflation
         WAGP = WAGP * ADJINC.x, # adjusting dollar amounts for inflation
         SEMP = SEMP * ADJINC.x, # adjusting dollar amounts for inflation
         hours_worked = WKHP * WKW) %>% # total number of hours worked
  
  # selecting which variables to keep
  select(SEX, AGEP, CIT, RAC1P, MIL, DIS, # general demographics
         MAR, HUPARC, NRC, FER, # family and household
         SCHL, FOD1P, FOD2P, SCIENGP, # educational background
         ESR, COW, hours_worked, NAICSP, # employment
         HINCP, WAGP, # income
         REGION.x, ST.x) %>% # location
  
  # renaming the variables
  rename(sex = SEX,
         age = AGEP,
         citizenship = CIT,
         race = RAC1P,
         military = MIL,
         disabled = DIS,
         married = MAR,
         children_age = HUPARC,
         children_no = NRC,
         gave_birth = FER,
         education = SCHL,
         degree_1 = FOD1P,
         degree_2 = FOD2P,
         stem_degree = SCIENGP,
         employment = ESR,
         worker_class = COW,
         industry = NAICSP,
         hh_income = HINCP,
         wage_income = WAGP,
         region = REGION.x,
         state = ST.x) %>%
  
  # converting inputs to an appropriate data type
  mutate(sex = as.factor(sex) %>%
           fct_recode(!!!sex_levels),
         citizenship = as.factor(citizenship) %>%
           fct_recode(!!!citizenship_levels),
         race = as.factor(race) %>%
           fct_recode(!!!race_levels),
         military = as.factor(military) %>%
           fct_recode(!!!military_levels),
         disabled = as.factor(disabled) %>%
           fct_recode(!!!disabled_levels),
         married = as.factor(married) %>%
           fct_recode(!!!married_levels),
         children_age = as.factor(children_age) %>%
           fct_recode(!!!children_age_levels),
         gave_birth = as.factor(gave_birth) %>%
           fct_recode(!!!gave_birth_levels),
         education = as.factor(education) %>%
           fct_recode(!!!education_levels),
         stem_degree = as.factor(stem_degree) %>%
           fct_recode(!!!stem_degree_levels),
         employment = as.factor(employment) %>%
           fct_recode(!!!employment_levels),
         region = as.factor(region) %>%
           fct_recode(!!!region_levels),
         state = as.factor(state) %>%
           fct_recode(!!!state_levels))

# changing underscores to spaces
acs_sample <- map_df(acs_sample, function(x) {
                      str_replace_all(x, "_", " ")
                    })

# Remaining work to be done:
# - convert inputs to appropriate data types (e.g. factors)
# - merge degree variables into one (after conversion)
```

# Data exploration

<!-- Explore distributions and associations graphically and numerically. -->

# Data analysis

<!-- Perform analyses. -->

# Assessment


\newpage

# Current questions

<!-- If you are running into issues or have wrangling problems outside of your skillset, let me know here how I can help! You can also ask for pointers on how to implement a method that maybe we haven't covered in course but you would like to include. -->
